{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://mxjson.org/schema/v1.0/mxjson.schema.json",
  "title": "MxJSON Protocol Schema",
  "description": "Schema definition for MxJSON capability packages - 企业级AI能力封装协议规范",
  "type": "object",
  "required": ["version", "metadata", "capability"],
  "properties": {
    "version": {
      "type": "string",
      "pattern": "^[0-9]+\\.[0-9]+\\.[0-9]+$",
      "description": "MxJSON protocol version (SemVer format)",
      "examples": ["1.0.0"]
    },
    "metadata": {
      "type": "object",
      "description": "Capability metadata - 能力元信息",
      "required": ["id", "name", "author"],
      "properties": {
        "id": {
          "type": "string",
          "pattern": "^[a-z0-9-]+$",
          "description": "Unique capability identifier (lowercase, hyphen-separated)"
        },
        "name": {
          "type": "string",
          "description": "Human-readable capability name"
        },
        "author": {
          "type": "string",
          "description": "Author name or organization"
        },
        "description": {
          "type": "string",
          "description": "Brief description of the capability"
        },
        "version": {
          "type": "string",
          "pattern": "^[0-9]+\\.[0-9]+\\.[0-9]+$",
          "description": "Capability version"
        },
        "tags": {
          "type": "array",
          "items": { "type": "string" },
          "description": "Searchable tags for categorization"
        },
        "license": {
          "type": "string",
          "description": "License type (e.g., MIT, Apache-2.0, Commercial)"
        },
        "homepage": {
          "type": "string",
          "format": "uri",
          "description": "Project homepage URL"
        }
      }
    },
    "capability": {
      "type": "object",
      "description": "Core capability definition - 核心能力定义",
      "properties": {
        "type": {
          "type": "string",
          "enum": ["prompt", "workflow", "agent", "tool"],
          "description": "Capability type"
        },
        "inputs": {
          "type": "object",
          "description": "Input schema definition",
          "additionalProperties": {
            "$ref": "#/definitions/inputField"
          }
        },
        "outputs": {
          "type": "object",
          "description": "Output schema definition",
          "additionalProperties": {
            "$ref": "#/definitions/outputField"
          }
        },
        "steps": {
          "type": "array",
          "description": "Workflow steps (for workflow type)",
          "items": {
            "$ref": "#/definitions/step"
          }
        },
        "prompt": {
          "type": "string",
          "description": "Prompt template (for prompt type)"
        },
        "model": {
          "type": "object",
          "description": "AI model configuration",
          "properties": {
            "provider": {
              "type": "string",
              "enum": ["openai", "anthropic", "azure", "custom"]
            },
            "name": {
              "type": "string"
            },
            "parameters": {
              "type": "object",
              "properties": {
                "temperature": { "type": "number", "minimum": 0, "maximum": 2 },
                "max_tokens": { "type": "integer", "minimum": 1 },
                "top_p": { "type": "number", "minimum": 0, "maximum": 1 }
              }
            }
          }
        }
      }
    },
    "pricing": {
      "type": "object",
      "description": "Commercial pricing configuration - 商业定价配置",
      "properties": {
        "model": {
          "type": "string",
          "enum": ["free", "per_call", "subscription", "custom"],
          "description": "Pricing model"
        },
        "currency": {
          "type": "string",
          "default": "CNY",
          "description": "Currency code (ISO 4217)"
        },
        "price": {
          "type": "number",
          "minimum": 0,
          "description": "Price per unit"
        },
        "unit": {
          "type": "string",
          "enum": ["call", "token", "minute", "month"],
          "description": "Billing unit"
        },
        "trial": {
          "type": "object",
          "properties": {
            "enabled": { "type": "boolean" },
            "limit": { "type": "integer" }
          }
        }
      }
    },
    "audit": {
      "type": "object",
      "description": "Audit and compliance settings - 审计与合规配置",
      "properties": {
        "enabled": {
          "type": "boolean",
          "default": true,
          "description": "Enable audit logging"
        },
        "retention_days": {
          "type": "integer",
          "minimum": 1,
          "description": "Audit log retention period"
        },
        "sensitive_fields": {
          "type": "array",
          "items": { "type": "string" },
          "description": "Fields to mask in logs"
        },
        "mask_pattern": {
          "type": "string",
          "default": "***",
          "description": "Pattern for masking sensitive data"
        }
      }
    },
    "human_review": {
      "type": "object",
      "description": "Human-in-the-loop configuration - 人工审核配置",
      "properties": {
        "enabled": {
          "type": "boolean",
          "default": false
        },
        "trigger": {
          "type": "string",
          "enum": ["always", "confidence_threshold", "keyword", "custom"],
          "description": "When to trigger human review"
        },
        "threshold": {
          "type": "number",
          "minimum": 0,
          "maximum": 1,
          "description": "Confidence threshold for review trigger"
        },
        "timeout_minutes": {
          "type": "integer",
          "description": "Review timeout in minutes"
        },
        "fallback_action": {
          "type": "string",
          "enum": ["approve", "reject", "escalate"],
          "description": "Action when review times out"
        }
      }
    },
    "ui": {
      "type": "object",
      "description": "Dynamic UI rendering configuration - 动态界面配置",
      "properties": {
        "type": {
          "type": "string",
          "enum": ["form", "chat", "wizard", "custom"],
          "description": "UI type"
        },
        "theme": {
          "type": "string"
        },
        "layout": {
          "type": "object",
          "description": "Layout configuration"
        },
        "components": {
          "type": "array",
          "items": {
            "$ref": "#/definitions/uiComponent"
          }
        }
      }
    }
  },
  "definitions": {
    "inputField": {
      "type": "object",
      "required": ["type"],
      "properties": {
        "type": {
          "type": "string",
          "enum": ["string", "number", "boolean", "array", "object", "file"]
        },
        "label": { "type": "string" },
        "description": { "type": "string" },
        "required": { "type": "boolean" },
        "default": {},
        "validation": {
          "type": "object",
          "properties": {
            "pattern": { "type": "string" },
            "min": { "type": "number" },
            "max": { "type": "number" },
            "minLength": { "type": "integer" },
            "maxLength": { "type": "integer" }
          }
        }
      }
    },
    "outputField": {
      "type": "object",
      "required": ["type"],
      "properties": {
        "type": {
          "type": "string",
          "enum": ["string", "number", "boolean", "array", "object", "file"]
        },
        "description": { "type": "string" }
      }
    },
    "step": {
      "type": "object",
      "required": ["id", "type"],
      "properties": {
        "id": { "type": "string" },
        "name": { "type": "string" },
        "type": {
          "type": "string",
          "enum": ["llm", "tool", "condition", "loop", "human_review", "parallel"]
        },
        "config": { "type": "object" },
        "next": {
          "oneOf": [
            { "type": "string" },
            { "type": "array", "items": { "type": "string" } }
          ]
        }
      }
    },
    "uiComponent": {
      "type": "object",
      "required": ["type"],
      "properties": {
        "type": {
          "type": "string",
          "enum": ["input", "textarea", "select", "checkbox", "radio", "file", "button", "display"]
        },
        "id": { "type": "string" },
        "label": { "type": "string" },
        "bind": { "type": "string" },
        "props": { "type": "object" }
      }
    }
  }
}
